# Maintainer: Kevin Schoon <kevinschoon@gmail.com>
pkgname=mesos
pkgver=1.2.0
pkgrel=0
pkgdesc="Apache Mesos distributed systems kernel"
url="https://mesos.apache.org/"
arch="all"
license="ASL 2.0"
depends=""
depends_dev="apr-dev curl-dev cyrus-sasl-crammd5 cyrus-sasl-dev fts-dev libstdc++ linux-headers subversion-dev zlib-dev"
makedepends="$depends_dev"
install=""
subpackages="$pkgname-dev"
source="
https://archive.apache.org/dist/${pkgname}/${pkgver}/${pkgname}-${pkgver}.tar.gz
mesos.confd
mesos-master.initd
mesos-agent.initd
"

builddir="${pkgname}-${pkgver}"

build() {
  cd "$builddir"
  cp -v /usr/include/locale.h ./include/xlocale.h
    CPPFLAGS="${CPPFLAGS} -I $PWD/include" \
    CXXFLAGS="${CXXFLAGS} -Wno-maybe-uninitialized" \
    ./configure \
    --prefix=/usr \
    --sysconfdir=/etc \
    --mandir=/usr/share/man \
    --localstatedir=/var \
    --disable-dependency-tracking \
    --disable-java \
    --disable-python \
    --enable-optimize \
    --enable-silent-rules \
    || return 1
  make -j"3" \
  || return 1
}

package() {
  cd "${srcdir}/${builddir}"
	make DESTDIR="$pkgdir" install || return 1
  cd "${srcdir}"
  install -Dm755 mesos-master.initd \
    "$pkgdir"/etc/init.d/mesos-master || return 1
  install -Dm755 mesos-agent.initd \
    "$pkgdir"/etc/init.d/mesos-agent || return 1

	install -Dm644 mesos.confd \
		"$pkgdir"/etc/conf.d/mesos-master || return 1
	install -Dm644 mesos.confd \
		"$pkgdir"/etc/conf.d/mesos-agent || return 1
}

md5sums="3585de784da66bb4c6df04a1e6bcb439  mesos-1.2.0.tar.gz
d705e9d4116568c7074acf730d6a2acf  mesos.confd
1aa6babfb568fe9bbde104117fdd7179  mesos-master.initd
1aa6babfb568fe9bbde104117fdd7179  mesos-agent.initd"
sha256sums="60dfd06cd1eec6f69af4ff77f7a92043fe7ead60bedf5605eecd14ffa7a3fb41  mesos-1.2.0.tar.gz
6dafd255fc11677f880ae41f4250aa4f6428a7e8f13b8f54908bcf59e26da68e  mesos.confd
e017812cb223575153572d5ed00eac3314d80b624fb38ab312bef0016bd40c16  mesos-master.initd
e017812cb223575153572d5ed00eac3314d80b624fb38ab312bef0016bd40c16  mesos-agent.initd"
sha512sums="431366088bf0ee949fe0b2addeaaa0c103c3a3246d8befca7d1d5b44e1852d6ca4ce9af056bd683aa53ccc07cc553c5ea3a457f9d75036d1e249070d13ed5569  mesos-1.2.0.tar.gz
18e8117d743995643bf2264772b91d1d750bcf03818cd0283803756fad2c0023630a3080945102e1fde95ac3a551bda2112d445a4deeb2739e2aace0d64acf53  mesos.confd
f15e4d6c89e3a9035a0fef95305344d3fd18c27dce43b637db5c9b32b109e16c0cf77717d7ec43944ea2c55071b6a7c4d2f9b52455eabe1e7fddc04a8acb3bbd  mesos-master.initd
f15e4d6c89e3a9035a0fef95305344d3fd18c27dce43b637db5c9b32b109e16c0cf77717d7ec43944ea2c55071b6a7c4d2f9b52455eabe1e7fddc04a8acb3bbd  mesos-agent.initd"
